/*
 * ATTENTION: The "eval" devtool has been used (maybe by default in mode: "development").
 * This devtool is neither made for production nor for readable output files.
 * It uses "eval()" calls to create a separate source file in the browser devtools.
 * If you are trying to read the output file, select a different devtool (https://webpack.js.org/configuration/devtool/)
 * or disable the default devtool with "devtool: false".
 * If you are looking for production-ready output files, see mode: "production" (https://webpack.js.org/configuration/mode/).
 */
/******/ (() => { // webpackBootstrap
/******/ 	"use strict";
/******/ 	var __webpack_modules__ = ({

/***/ "./src/styles.scss":
/*!*************************!*\
  !*** ./src/styles.scss ***!
  \*************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

eval("__webpack_require__.r(__webpack_exports__);\n// extracted by mini-css-extract-plugin\n\n\n//# sourceURL=webpack://squareapp/./src/styles.scss?");

/***/ }),

/***/ "./src/index.js":
/*!**********************!*\
  !*** ./src/index.js ***!
  \**********************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

eval("__webpack_require__.r(__webpack_exports__);\n/* harmony import */ var _styles_scss__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ./styles.scss */ \"./src/styles.scss\");\n/* harmony import */ var _scripts_interface_js__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ./scripts/interface.js */ \"./src/scripts/interface.js\");\n/* harmony import */ var _scripts_canvas_js__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! ./scripts/canvas.js */ \"./src/scripts/canvas.js\");\n/* harmony import */ var _scripts_state_js__WEBPACK_IMPORTED_MODULE_3__ = __webpack_require__(/*! ./scripts/state.js */ \"./src/scripts/state.js\");\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n(0,_scripts_interface_js__WEBPACK_IMPORTED_MODULE_1__.setup)()\r\n;(0,_scripts_canvas_js__WEBPACK_IMPORTED_MODULE_2__.setup)()\r\n\r\n;(0,_scripts_state_js__WEBPACK_IMPORTED_MODULE_3__.checkForPermission)()\r\n\r\n\n\n//# sourceURL=webpack://squareapp/./src/index.js?");

/***/ }),

/***/ "./src/scripts/canvas.js":
/*!*******************************!*\
  !*** ./src/scripts/canvas.js ***!
  \*******************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   \"finalize\": () => (/* binding */ finalize),\n/* harmony export */   \"resizeCanvas\": () => (/* binding */ resizeCanvas),\n/* harmony export */   \"setup\": () => (/* binding */ setup),\n/* harmony export */   \"snap\": () => (/* binding */ snap),\n/* harmony export */   \"toggleCanvas\": () => (/* binding */ toggleCanvas)\n/* harmony export */ });\n/* harmony import */ var _interface_js__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ./interface.js */ \"./src/scripts/interface.js\");\n\r\n\r\n\r\nlet snapCan,snapCtx\r\nlet bwCan,bwCtx\r\nlet thrCan,thrCtx\r\nlet resCan,resCtx\r\nlet imageData,arrayData,bwArrayData,thrArrayData,resArrayData\r\nlet width,height\r\n\r\nfunction setup(){\r\n\tsnapCan=document.querySelector(\"#snap-canvas\")\r\n\tsnapCtx=snapCan.getContext(\"2d\",{willReadFrequently:true})\r\n\t\r\n\tbwCan=document.querySelector(\"#bw-canvas\")\r\n\tbwCtx=bwCan.getContext(\"2d\",{willReadFrequently:true})\r\n\r\n\tthrCan=document.querySelector(\"#thr-canvas\")\r\n\tthrCtx=thrCan.getContext(\"2d\",{willReadFrequently:true})\r\n\r\n\tresCan=document.querySelector(\"#res-canvas\")\r\n\tresCtx=resCan.getContext(\"2d\",{willReadFrequently:true})\r\n}\r\n\r\nfunction toggleCanvas(){\r\n\t\tresCan.className.toggle(\"offscreen-canvas\")\r\n}\r\n\r\nfunction resizeCanvas(widthIn,heightIn){\r\n\twidth=widthIn\r\n\theight=heightIn\r\n\r\n\tsnapCan.width=width\r\n\tsnapCan.height=height\r\n\r\n\tbwCan.width=width\r\n\tbwCan.height=height\r\n\r\n\tthrCan.width=width\r\n\tthrCan.height=height\r\n\tthrCan.style.left=(.5*(innerWidth-width))+\"px\"\r\n\tthrCan.style.top=(.5*(innerHeight-height))+\"px\"\r\n\r\n\tresCan.width=width\r\n\tresCan.height=height\r\n\tresCan.style.left=(.5*(innerWidth-width))+\"px\"\r\n\tresCan.style.top=(.5*(innerHeight-height))+\"px\"\r\n\tresCan.style.display=\"none\"\r\n}\r\n\r\nfunction snap(){\r\n\tsnapCtx.drawImage(_interface_js__WEBPACK_IMPORTED_MODULE_0__.video,0,0,width,height)\r\n\r\n\timageData=snapCtx.getImageData(0,0,width,height)\r\n\tarrayData=new Uint8ClampedArray(imageData.data)\r\n\tbwArrayData=arrayData.slice()\r\n\tthrArrayData=arrayData.slice()\r\n\tresArrayData=arrayData.slice()\r\n\r\n\tgrayscale(50)\r\n\tthreshold(128)\r\n\t_interface_js__WEBPACK_IMPORTED_MODULE_0__.simpleSlider.addEventListener(\"click\",handleThreshold)\r\n\t_interface_js__WEBPACK_IMPORTED_MODULE_0__.simpleSlider.placeCursor(.5)\r\n}\r\n\r\nfunction handleThreshold(ev){\r\n\tlet ratio=ev.clientX/window.innerWidth\r\n\t_interface_js__WEBPACK_IMPORTED_MODULE_0__.simpleSlider.placeCursor(ratio)\r\n\tlet thr=Math.abs((1-ratio)*255)\r\n\tthreshold(thr)\r\n}\r\n\r\n\r\nfunction grayscale(offset){\r\n\tfor(let i=0;i<arrayData.length;i+=4){\r\n\t\tlet [r,g,b]=arrayData.slice(i,i+3)\r\n\t\tlet mean=0.299*r + 0.587*g + 0.114*b+offset\r\n\t\tbwArrayData.set([mean,mean,mean],i)\r\n\t}\r\n\tlet imgData=new ImageData(bwArrayData,width,height)\r\n\tbwCtx.putImageData(imgData,0,0)\r\n}\r\n\r\nfunction threshold(threshold){\r\n\tfor(let i=0;i<arrayData.length;i+=4){\r\n\t\tlet [r,g,b]=arrayData.slice(i,i+3)\r\n\t\tlet mean=0.299*r + 0.587*g + 0.114*b\r\n\t\tif(mean>threshold) thrArrayData.set([255,255,255],i)\r\n\t\telse  thrArrayData.set([0,0,0],i)\r\n\t}\r\n\tlet imgData=new ImageData(thrArrayData,width,height)\r\n\tthrCtx.putImageData(imgData,0,0)\r\n}\r\n\r\n\r\nlet squares=[]\r\n\r\nfunction finalize(){\r\n\tsquarize()\r\n}\r\n\r\nfunction squarize(){\r\n\tlet video=document.querySelector(\"video\")\r\n\tlet ratio=Math.floor(video.videoWidth/video.videoHeight*10)\r\n\tlet n=4\r\n\tlet ratioX=Math.floor(n)\r\n\tlet ratioY=Math.floor(ratio/n)\r\n\tconsole.log(ratioX,ratioY)\r\n\tfirstGrid(ratioX,ratioY)\r\n\r\n\trefineGrid(10,64,.25)\r\n\trefineGrid(10,32,.25)\r\n\trefineGrid(5,32,.15)\r\n\trefineGrid(5,16,.15)\r\n\trefineGrid(4,16,.5)\r\n\trefineGrid(2,8,.5)\r\n\r\n\tresCan.style.display=\"block\"\r\n\r\n\tdrawSquares()\r\n}\r\n\r\nfunction firstGrid(n,m){\r\n\tsquares=subdivide([0,0,width,height],n,m)\r\n}\r\nfunction refineGrid(side,threshold,random=.35){\r\n\tlet newSquares=[]\r\n\tfor(let sq of squares){\r\n\t\tif(checkSquare(sq,side,threshold)) newSquares.push(...subdivide(sq,2,2))\r\n\t\telse newSquares.push(sq)\r\n\t}\r\n\tsquares=newSquares\r\n}\r\n\r\nfunction checkSquare(square,minSide,threshold,random=.35){\r\n\tif(Math.random()<random) return true\r\n\tlet sides=[square[2]-square[0],square[3]-square[1]]\r\n\tif(sides[0]<minSide||sides[1]<minSide) return false\r\n\r\n\tlet corners=[\r\n\t\tthrCtx.getImageData(square[0],square[1],1,1).data[0],\r\n\t\tthrCtx.getImageData(square[2],square[1],1,1).data[0],\r\n\t\tthrCtx.getImageData(square[2],square[3],1,1).data[0],\r\n\t\tthrCtx.getImageData(square[0],square[3],1,1).data[0]\r\n\t]\r\n\tif(corners[0]!=corners[1]||corners[1]!=corners[2]||corners[2]!=corners[3]||corners[3]!=corners[0]||corners[0]!=corners[2]||corners[1]!=corners[3]){\r\n\t\treturn true\r\n\t}\r\n\t\r\n\tlet data=bwCtx.getImageData(square[0],square[1],...sides).data\r\n\tlet mean=0\r\n\tfor(let i=0;i<data.length;i=i+4){\r\n\t\tmean+=data[i]+data[i+1]+data[i+2]\r\n\t}\r\n\tmean=mean/(data.length*.75)\r\n\tif(mean<threshold) return true\r\n\t\r\n\treturn false\r\n}\r\n\r\nfunction subdivide(square,dx,dy){\r\n\tlet sideX=(square[2]-square[0])/dx\r\n\tlet sideY=(square[3]-square[1])/dy\r\n\tlet newSquares=[]\r\n\tfor(let j=0;j<dy;j++){\r\n\t\tfor(let i=0;i<dx;i++){\r\n\t\t\tnewSquares.push([square[0]+i*sideX,square[1]+j*sideY,square[0]+(i+1)*sideX,square[1]+(j+1)*sideY])\r\n\t\t}\r\n\t}\r\n\treturn newSquares\r\n}\r\n\r\nfunction drawSquares(){\r\n\tresCtx.fillStyle=\"black\"\r\n\tresCtx.fillRect(0,0,width,height)\r\n\r\n\tresCtx.globalAlpha=.1\r\n\r\n\tlet alfa=Math.PI/326\r\n\tfor(let sq of squares){\r\n\t\tlet randomColor=Math.floor(Math.random()*40-20)\r\n\t\tfor(let i=0;i<8;i++){\r\n\t\t\tlet randomAngle=Math.random()*2*alfa-.5*alfa\r\n\t\t\tresCtx.rotate(randomAngle)\r\n\t\t\tresCtx.strokeStyle=`hsl(${150+randomColor},100%,50%)`\r\n\t\t\tresCtx.strokeRect(sq[0],sq[1],sq[2]-sq[0],sq[3]-sq[1])\r\n\t\t\tresCtx.rotate(-randomAngle)\r\n\t\t}\r\n\t}\r\n}\r\n\n\n//# sourceURL=webpack://squareapp/./src/scripts/canvas.js?");

/***/ }),

/***/ "./src/scripts/devices.js":
/*!********************************!*\
  !*** ./src/scripts/devices.js ***!
  \********************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   \"checkPermission\": () => (/* binding */ checkPermission),\n/* harmony export */   \"findDevices\": () => (/* binding */ findDevices),\n/* harmony export */   \"startDevice\": () => (/* binding */ startDevice),\n/* harmony export */   \"stopCurrentStream\": () => (/* binding */ stopCurrentStream)\n/* harmony export */ });\n/* harmony import */ var _state_js__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ./state.js */ \"./src/scripts/state.js\");\n/* harmony import */ var _canvas_js__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ./canvas.js */ \"./src/scripts/canvas.js\");\n/* harmony import */ var _interface_js__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! ./interface.js */ \"./src/scripts/interface.js\");\n\r\n\r\n\r\n\r\nlet devices=[]\r\nlet usefulDevices=[]\r\nlet currentStream\r\n\r\nasync function checkPermission(){\r\n\tlet permissionGranted\r\n\tawait navigator.mediaDevices.getUserMedia({video:true})\r\n\t.then(stream=>{\r\n\t\tconsole.log(\"Permission granted\")\r\n\t\tpermissionGranted=true\r\n\t})\r\n\t.catch(err=>{\r\n\t\tpermissionGranted=false\r\n\t\tconsole.log(\"Permission not granted\")\r\n\t\tconsole.log(err)\r\n\t})\r\n\treturn permissionGranted\r\n}\r\n\r\n\r\nasync function findDevices(){\r\n\tdevices=[]\r\n\tusefulDevices=[]\r\n\t\r\n\tawait navigator.mediaDevices.enumerateDevices()\r\n\t.then(devs=>{\r\n\t\tfor(let d of devs){\r\n\t\t\tlet caps=d.getCapabilities()\r\n\t\t\tdevices.push({device:d,capabilities:caps})\r\n\t\t}\r\n\t})\r\n\t.catch(err=>{\r\n\t\t// console.log(\"not a useful device\")\r\n\t\t// console.log(err)\r\n\t\tdevices.push({})\r\n\t})\r\n\t.finally(()=>{\r\n\t\tanalyseDevices()\r\n\t})\r\n\r\n\treturn usefulDevices\r\n}\r\n\r\nfunction analyseDevices(){\t\r\n\t//filter for video and empties\r\n\tdevices=devices.filter(el=>{return el.device!=undefined && el.device.kind!=\"audioinput\" && el.capabilities.facingMode!=undefined && el.capabilities.facingMode?.length!=0})\r\n\t\r\n\tfor(let d of devices){\r\n\t\tlet info={\r\n\t\t\tdeviceId:d.device.deviceId,\r\n\t\t\tgroupId:d.device.groupId,\r\n\t\t\tlabel:d.device.label,\r\n\t\t\twidth:d.capabilities.width,\r\n\t\t\theight:d.capabilities.height,\r\n\t\t\tfacingMode:d.capabilities.facingMode\r\n\t\t}\r\n\t\tusefulDevices.push(info)\r\n\t}\r\n}\r\n\r\n\r\nfunction startDevice(device){\r\n\tconsole.log(\"device selezionata: \")\r\n\tconsole.log(device)\r\n\tnavigator.mediaDevices.getUserMedia({\r\n\t\tvideo:{\r\n\t\t\tdeviceId:device.deviceId,\r\n\t\t\tfacingMode:{exact:device.facingMode}\r\n\t\t}\r\n\t})\r\n\t.then((stream)=>{\r\n\t\tcurrentStream=stream\r\n\r\n\t\tlet video=document.querySelector(\"video\")\r\n\t\tvideo.addEventListener(\"canplay\",()=>{\r\n\t\t\t;(0,_canvas_js__WEBPACK_IMPORTED_MODULE_1__.resizeCanvas)(video.videoWidth,video.videoHeight)\r\n\t\t\t// resizeCanvas(window.innerWidth,window.innerHeight)\r\n\r\n\t\t\t;(0,_state_js__WEBPACK_IMPORTED_MODULE_0__.awaitSnap)()\r\n\t\t})\r\n\r\n\t\tvideo.srcObject=stream\r\n\t\tvideo.play()\r\n\t\t\r\n\t})\r\n}\r\n\r\nfunction stopCurrentStream(){\r\n\tif(currentStream!=undefined){\r\n\t\tcurrentStream.getTracks().forEach(track=>{track.stop()})\r\n\t}\r\n}\r\n\n\n//# sourceURL=webpack://squareapp/./src/scripts/devices.js?");

/***/ }),

/***/ "./src/scripts/interface.js":
/*!**********************************!*\
  !*** ./src/scripts/interface.js ***!
  \**********************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   \"backToDeviceButton\": () => (/* binding */ backToDeviceButton),\n/* harmony export */   \"bwCan\": () => (/* binding */ bwCan),\n/* harmony export */   \"cancelButton\": () => (/* binding */ cancelButton),\n/* harmony export */   \"caption\": () => (/* binding */ caption),\n/* harmony export */   \"deviceButtons\": () => (/* binding */ deviceButtons),\n/* harmony export */   \"loadingWidget\": () => (/* binding */ loadingWidget),\n/* harmony export */   \"noButton\": () => (/* binding */ noButton),\n/* harmony export */   \"okButton\": () => (/* binding */ okButton),\n/* harmony export */   \"resCan\": () => (/* binding */ resCan),\n/* harmony export */   \"resnapButton\": () => (/* binding */ resnapButton),\n/* harmony export */   \"setup\": () => (/* binding */ setup),\n/* harmony export */   \"shareButton\": () => (/* binding */ shareButton),\n/* harmony export */   \"simpleSlider\": () => (/* binding */ simpleSlider),\n/* harmony export */   \"snapButton\": () => (/* binding */ snapButton),\n/* harmony export */   \"snapCan\": () => (/* binding */ snapCan),\n/* harmony export */   \"thrCan\": () => (/* binding */ thrCan),\n/* harmony export */   \"video\": () => (/* binding */ video)\n/* harmony export */ });\nlet video\r\nlet snapCan\r\nlet bwCan\r\nlet thrCan\r\nlet resCan\r\n\r\nlet loadingWidget\r\nlet deviceButtons\r\nlet snapButton\r\nlet backToDeviceButton\r\nlet okButton\r\nlet noButton\r\nlet resnapButton\r\nlet cancelButton\r\nlet shareButton\r\nlet caption\r\nlet simpleSlider\r\n\r\n\r\nfunction setup(){\r\n\t//video&canvas\r\n\tvideo=document.createElement(\"video\")\r\n\tdocument.body.append(video)\r\n\r\n\tconst container=document.querySelector(\"#canvas-container\")\r\n\tsnapCan=document.createElement(\"canvas\")\r\n\tsnapCan.classList.add(\"offscreen-canvas\")\r\n\tcontainer.append(snapCan)\r\n\tsnapCan.id=\"snap-canvas\"\r\n\r\n\tbwCan=document.createElement(\"canvas\")\r\n\tbwCan.classList.add(\"offscreen-canvas\")\r\n\tcontainer.append(bwCan)\r\n\tbwCan.id=\"bw-canvas\"\r\n\r\n\tthrCan=document.createElement(\"canvas\")\r\n\tthrCan.classList.add(\"offscreen-canvas\")\r\n\tcontainer.append(thrCan)\r\n\tthrCan.id=\"thr-canvas\"\r\n\r\n\tresCan=document.createElement(\"canvas\")\r\n\tresCan.classList.add(\"offscreen-canvas\")\r\n\tcontainer.append(resCan)\r\n\tresCan.id=\"res-canvas\"\r\n\r\n\t//loading widget\r\n\tloadingWidget=document.createElement(\"loading-widget\")\r\n\tloadingWidget.setAttribute(\"time\",\".2\")\r\n\tdocument.body.append(loadingWidget)\r\n\r\n\t//device buttons\r\n\tdeviceButtons=document.createElement(\"device-buttons\")\r\n\tdocument.body.append(deviceButtons)\r\n\r\n\t//snap button\r\n\tsnapButton=document.createElement(\"snap-button\")\r\n\tdocument.body.append(snapButton)\r\n\t//backToDevice button\r\n\tbackToDeviceButton=document.createElement(\"simple-button\")\r\n\tbackToDeviceButton.setAttribute(\"side\",\"corner\")\r\n\tbackToDeviceButton.setAttribute(\"type\",\"backToDevice\")\r\n\tdocument.body.append(backToDeviceButton)\r\n\r\n\t//no button\r\n\tnoButton=document.createElement(\"simple-button\")\r\n\tnoButton.setAttribute(\"side\",\"left\")\r\n\tnoButton.setAttribute(\"type\",\"no\")\r\n\tdocument.body.append(noButton)\r\n\t//ok button\r\n\tokButton=document.createElement(\"simple-button\")\r\n\tokButton.setAttribute(\"side\",\"right\")\r\n\tokButton.setAttribute(\"type\",\"ok\")\r\n\tdocument.body.append(okButton)\r\n\r\n\t//resnap button\r\n\tresnapButton=document.createElement(\"simple-button\")\r\n\tresnapButton.setAttribute(\"side\",\"left\")\r\n\tresnapButton.setAttribute(\"type\",\"resnap\")\r\n\tdocument.body.append(resnapButton)\r\n\t//cancel button\r\n\tcancelButton=document.createElement(\"simple-button\")\r\n\tcancelButton.setAttribute(\"side\",\"center\")\r\n\tcancelButton.setAttribute(\"type\",\"cancel\")\r\n\tdocument.body.append(cancelButton)\r\n\t//share button\r\n\tshareButton=document.createElement(\"simple-button\")\r\n\tshareButton.setAttribute(\"side\",\"right\")\r\n\tshareButton.setAttribute(\"type\",\"share\")\r\n\tdocument.body.append(shareButton)\r\n\r\n\t//caption\r\n\tcaption=document.createElement(\"simple-caption\")\r\n\tdocument.body.append(caption)\r\n\r\n\t//slider\r\n\tsimpleSlider=document.createElement(\"simple-slider\")\r\n\tdocument.body.append(simpleSlider)\r\n\t\r\n}\r\n\r\n\n\n//# sourceURL=webpack://squareapp/./src/scripts/interface.js?");

/***/ }),

/***/ "./src/scripts/state.js":
/*!******************************!*\
  !*** ./src/scripts/state.js ***!
  \******************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   \"awaitConfirmSnap\": () => (/* binding */ awaitConfirmSnap),\n/* harmony export */   \"awaitDeviceChoice\": () => (/* binding */ awaitDeviceChoice),\n/* harmony export */   \"awaitSnap\": () => (/* binding */ awaitSnap),\n/* harmony export */   \"checkForDevices\": () => (/* binding */ checkForDevices),\n/* harmony export */   \"checkForPermission\": () => (/* binding */ checkForPermission)\n/* harmony export */ });\n/* harmony import */ var _interface_js__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ./interface.js */ \"./src/scripts/interface.js\");\n/* harmony import */ var _devices_js__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ./devices.js */ \"./src/scripts/devices.js\");\n/* harmony import */ var _canvas_js__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! ./canvas.js */ \"./src/scripts/canvas.js\");\n\r\n\r\n\r\n\r\nconst availableDevices={\r\n\tuser:undefined,\r\n\tenvironment:undefined\r\n}\r\n\r\nfunction checkForPermission(){\r\n\tlet permission=false\r\n\r\n\t_interface_js__WEBPACK_IMPORTED_MODULE_0__.loadingWidget.show()\r\n\t_interface_js__WEBPACK_IMPORTED_MODULE_0__.caption.setText(`\r\n\tPlease wait while we check for permission to use camera\r\n\t<br><br>\r\n\tGive permission when/if asked to use the app!\r\n\t`)\r\n\t_interface_js__WEBPACK_IMPORTED_MODULE_0__.caption.show()\r\n\r\n\tsetTimeout(managePermission,2000)\r\n\r\n\tasync function managePermission(){\r\n\t\tconst granted=await (0,_devices_js__WEBPACK_IMPORTED_MODULE_1__.checkPermission)()\r\n\t\t\r\n\t\tpermission=granted\r\n\t\t\r\n\t\twindow.addEventListener(\"simple-caption\",closing)\r\n\t\t_interface_js__WEBPACK_IMPORTED_MODULE_0__.caption.hide()\r\n\t}\r\n\r\n\tfunction closing(event){\r\n\t\tif(event.detail.action==\"close\"){\r\n\t\t\tif(permission){\r\n\t\t\t\twindow.removeEventListener(\"simple-caption\",closing)\r\n\t\t\t\tsetTimeout(checkForDevices,500)\r\n\t\t\t}else{\r\n\t\t\t\t_interface_js__WEBPACK_IMPORTED_MODULE_0__.caption.setText(`\r\n\t\t\t\tSorry: no permission, no photo, no applications :(\r\n\t\t\t\t`)\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n}\r\n\r\nasync function checkForDevices(){\r\n\twindow.addEventListener(\"loading-widget\",closing)\r\n\r\n\tconst devices=await (0,_devices_js__WEBPACK_IMPORTED_MODULE_1__.findDevices)()\r\n\t\r\n\tlet userFacing\r\n\tlet environmentFacing\r\n\tfor(let d of devices){\r\n\t\tif(d.facingMode==\"user\"){\r\n\t\t\tif(!userFacing) userFacing=d\r\n\t\t\telse if(d.width.max>userFacing.width.max) userFacing=d\r\n\t\t}\r\n\t\telse if(d.facingMode==\"environment\"){\r\n\t\t\tif(!environmentFacing) environmentFacing=d\r\n\t\t\telse if(d.width.max>environmentFacing.width.max) environmentFacing=d\r\n\t\t}\r\n\t}\r\n\t\r\n\tconst selectedDevices=[]\r\n\tif(userFacing){\r\n\t\tselectedDevices.push(\"user\")\r\n\t\tavailableDevices.user=userFacing\r\n\t}\r\n\tif(environmentFacing){\r\n\t\tselectedDevices.push(\"environment\")\r\n\t\tavailableDevices.environment=environmentFacing\r\n\t}\r\n\r\n\tif(selectedDevices.length>0){\r\n\t\t_interface_js__WEBPACK_IMPORTED_MODULE_0__.deviceButtons.setAttribute(\"buttons\",selectedDevices.join(\" \"))\r\n\t\t_interface_js__WEBPACK_IMPORTED_MODULE_0__.loadingWidget.hide()\r\n\t}else{\r\n\t\t_interface_js__WEBPACK_IMPORTED_MODULE_0__.caption.setText(`\r\n\t\tWe couldn't find any usable stream on your device :(\r\n\t\t`)\r\n\t\t_interface_js__WEBPACK_IMPORTED_MODULE_0__.caption.show()\r\n\t}\r\n\r\n\tfunction closing(event){\r\n\t\tif(event.detail.action==\"close\"){\r\n\t\t\twindow.removeEventListener(\"loading-widget\",closing)\r\n\t\t\t_interface_js__WEBPACK_IMPORTED_MODULE_0__.deviceButtons.createButtons()\r\n\t\t\tawaitDeviceChoice()\r\n\t\t}\r\n\t}\r\n}\r\n\r\nfunction awaitDeviceChoice(){\r\n\t_interface_js__WEBPACK_IMPORTED_MODULE_0__.deviceButtons.show()\r\n\twindow.addEventListener(\"device-buttons\",startCamera)\r\n\r\n\tfunction startCamera(event){\r\n\t\tif(event.detail.action==\"user\"&&availableDevices.user){\r\n\t\t\t_interface_js__WEBPACK_IMPORTED_MODULE_0__.deviceButtons.hide()\r\n\t\t\t// loadingWidget.show()\r\n\t\t\t;(0,_devices_js__WEBPACK_IMPORTED_MODULE_1__.startDevice)(availableDevices.user)\r\n\t\t}else if(event.detail.action==\"user\"&&availableDevices.environment){\r\n\t\t\t_interface_js__WEBPACK_IMPORTED_MODULE_0__.deviceButtons.hide()\r\n\t\t\t// loadingWidget.show()\r\n\t\t\t;(0,_devices_js__WEBPACK_IMPORTED_MODULE_1__.startDevice)(availableDevices.environment)\r\n\t\t}\r\n\t}\r\n}\r\n\r\nfunction awaitSnap(){\r\n\t_interface_js__WEBPACK_IMPORTED_MODULE_0__.video.style.display=\"block\"\r\n\t_interface_js__WEBPACK_IMPORTED_MODULE_0__.resCan.style.opacity=0\r\n\t_interface_js__WEBPACK_IMPORTED_MODULE_0__.thrCan.style.opacity=0\r\n\t_interface_js__WEBPACK_IMPORTED_MODULE_0__.snapButton.show()\r\n\t_interface_js__WEBPACK_IMPORTED_MODULE_0__.backToDeviceButton.show()\r\n\twindow.addEventListener(\"snap-button\",manageSnap)\r\n\twindow.addEventListener(\"simple-button\",manageBack)\r\n\r\n\tfunction manageSnap(event){\r\n\t\tif(event.detail.action==\"close\"){\r\n\t\t\twindow.removeEventListener(\"snap-button\",manageSnap)\r\n\t\t\twindow.removeEventListener(\"simple-button\",manageSnap)\r\n\t\t\t;(0,_canvas_js__WEBPACK_IMPORTED_MODULE_2__.snap)()\r\n\t\t\t_interface_js__WEBPACK_IMPORTED_MODULE_0__.snapButton.hide()\r\n\t\t\t_interface_js__WEBPACK_IMPORTED_MODULE_0__.backToDeviceButton.hide()\r\n\t\t\tawaitConfirmSnap()\r\n\t\t}\r\n\t}\r\n\r\n\tfunction manageBack(event){\r\n\t\tif(event.detail.action==\"click\"&&event.detail?.type==\"backToDevice\"){\r\n\t\t\twindow.removeEventListener(\"snap-button\",manageSnap)\r\n\t\t\twindow.removeEventListener(\"simple-button\",manageSnap)\r\n\t\t\t_interface_js__WEBPACK_IMPORTED_MODULE_0__.snapButton.hide()\r\n\t\t\t_interface_js__WEBPACK_IMPORTED_MODULE_0__.backToDeviceButton.hide()\r\n\t\t\tawaitDeviceChoice()\r\n\t\t}\r\n\t}\r\n}\r\n\r\nfunction awaitConfirmSnap(){\r\n\t_interface_js__WEBPACK_IMPORTED_MODULE_0__.video.style.display=\"none\"\r\n\t_interface_js__WEBPACK_IMPORTED_MODULE_0__.resCan.style.opacity=0\r\n\t_interface_js__WEBPACK_IMPORTED_MODULE_0__.thrCan.style.opacity=1\r\n\t_interface_js__WEBPACK_IMPORTED_MODULE_0__.okButton.show()\r\n\t_interface_js__WEBPACK_IMPORTED_MODULE_0__.noButton.show()\r\n\t_interface_js__WEBPACK_IMPORTED_MODULE_0__.simpleSlider.show()\r\n\twindow.addEventListener(\"simple-button\",manageConfirm)\r\n\r\n\tfunction manageConfirm(event){\r\n\t\tif(event.detail.action==\"click\"){\r\n\t\t\tif(event.detail.type==\"ok\"){\r\n\t\t\t\twindow.removeEventListener(\"simple-button\",manageConfirm)\r\n\t\t\t\tawaitShare()\r\n\t\t\t\t;(0,_canvas_js__WEBPACK_IMPORTED_MODULE_2__.finalize)()\r\n\t\t\t\t_interface_js__WEBPACK_IMPORTED_MODULE_0__.okButton.hide()\r\n\t\t\t\t_interface_js__WEBPACK_IMPORTED_MODULE_0__.noButton.hide()\r\n\t\t\t\t_interface_js__WEBPACK_IMPORTED_MODULE_0__.simpleSlider.hide()\r\n\t\t\t}else if(event.detail.type==\"no\"){\r\n\t\t\t\twindow.removeEventListener(\"simple-button\",manageConfirm)\r\n\t\t\t\t_interface_js__WEBPACK_IMPORTED_MODULE_0__.okButton.hide()\r\n\t\t\t\t_interface_js__WEBPACK_IMPORTED_MODULE_0__.noButton.hide()\r\n\t\t\t\t_interface_js__WEBPACK_IMPORTED_MODULE_0__.simpleSlider.hide()\r\n\t\t\t\tawaitSnap()\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n}\r\n\r\nfunction awaitShare(){\r\n\t_interface_js__WEBPACK_IMPORTED_MODULE_0__.resCan.style.opacity=1\r\n\t_interface_js__WEBPACK_IMPORTED_MODULE_0__.thrCan.style.opacity=0\r\n\t_interface_js__WEBPACK_IMPORTED_MODULE_0__.resnapButton.show()\r\n\t// cancelButton.show()\r\n\t_interface_js__WEBPACK_IMPORTED_MODULE_0__.shareButton.show()\r\n\twindow.addEventListener(\"simple-button\",manageShare)\r\n\r\n\tfunction manageShare(event){\r\n\t\tif(event.detail.action==\"click\"){\r\n\t\t\tif(event.detail.type==\"resnap\"){\r\n\t\t\t\twindow.removeEventListener(\"simple-button\",manageShare)\r\n\t\t\t\tawaitSnap()\r\n\t\t\t\t_interface_js__WEBPACK_IMPORTED_MODULE_0__.resnapButton.hide()\r\n\t\t\t\t_interface_js__WEBPACK_IMPORTED_MODULE_0__.cancelButton.hide()\r\n\t\t\t\t_interface_js__WEBPACK_IMPORTED_MODULE_0__.shareButton.hide()\r\n\t\t\t}else if(event.detail.type==\"cancel\"){\r\n\t\t\t\twindow.removeEventListener(\"simple-button\",manageShare)\r\n\t\t\t\tawaitConfirmSnap()\r\n\t\t\t\t_interface_js__WEBPACK_IMPORTED_MODULE_0__.resnapButton.hide()\r\n\t\t\t\t_interface_js__WEBPACK_IMPORTED_MODULE_0__.cancelButton.hide()\r\n\t\t\t\t_interface_js__WEBPACK_IMPORTED_MODULE_0__.shareButton.hide()\r\n\t\t\t}else if(event.detail.type==\"share\"){\r\n\t\t\t\t// window.removeEventListener(\"simple-button\",manageShare)\r\n\t\t\t\t// resnapButton.hide()\r\n\t\t\t\t// cancelButton.hide()\r\n\t\t\t\t// shareButton.hide()\r\n\t\t\t\t\r\n\t\t\t  _interface_js__WEBPACK_IMPORTED_MODULE_0__.resCan.toBlob(blob=>{\r\n\t\t\t\t\tconst file=new File(\r\n\t\t\t\t\t\t[blob],\r\n\t\t\t\t\t\t'animation.png',\r\n\t\t\t\t\t\t{\r\n\t\t\t\t\t\t\ttype: blob.type,\r\n\t\t\t\t\t\t\tlastModified: new Date().getTime()\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t)\r\n\t\t\t\t\t\r\n  \t\t\t\tnavigator.share(file)\r\n\t\t\t\t})\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n}\n\n//# sourceURL=webpack://squareapp/./src/scripts/state.js?");

/***/ })

/******/ 	});
/************************************************************************/
/******/ 	// The module cache
/******/ 	var __webpack_module_cache__ = {};
/******/ 	
/******/ 	// The require function
/******/ 	function __webpack_require__(moduleId) {
/******/ 		// Check if module is in cache
/******/ 		var cachedModule = __webpack_module_cache__[moduleId];
/******/ 		if (cachedModule !== undefined) {
/******/ 			return cachedModule.exports;
/******/ 		}
/******/ 		// Create a new module (and put it into the cache)
/******/ 		var module = __webpack_module_cache__[moduleId] = {
/******/ 			// no module.id needed
/******/ 			// no module.loaded needed
/******/ 			exports: {}
/******/ 		};
/******/ 	
/******/ 		// Execute the module function
/******/ 		__webpack_modules__[moduleId](module, module.exports, __webpack_require__);
/******/ 	
/******/ 		// Return the exports of the module
/******/ 		return module.exports;
/******/ 	}
/******/ 	
/************************************************************************/
/******/ 	/* webpack/runtime/define property getters */
/******/ 	(() => {
/******/ 		// define getter functions for harmony exports
/******/ 		__webpack_require__.d = (exports, definition) => {
/******/ 			for(var key in definition) {
/******/ 				if(__webpack_require__.o(definition, key) && !__webpack_require__.o(exports, key)) {
/******/ 					Object.defineProperty(exports, key, { enumerable: true, get: definition[key] });
/******/ 				}
/******/ 			}
/******/ 		};
/******/ 	})();
/******/ 	
/******/ 	/* webpack/runtime/hasOwnProperty shorthand */
/******/ 	(() => {
/******/ 		__webpack_require__.o = (obj, prop) => (Object.prototype.hasOwnProperty.call(obj, prop))
/******/ 	})();
/******/ 	
/******/ 	/* webpack/runtime/make namespace object */
/******/ 	(() => {
/******/ 		// define __esModule on exports
/******/ 		__webpack_require__.r = (exports) => {
/******/ 			if(typeof Symbol !== 'undefined' && Symbol.toStringTag) {
/******/ 				Object.defineProperty(exports, Symbol.toStringTag, { value: 'Module' });
/******/ 			}
/******/ 			Object.defineProperty(exports, '__esModule', { value: true });
/******/ 		};
/******/ 	})();
/******/ 	
/************************************************************************/
/******/ 	
/******/ 	// startup
/******/ 	// Load entry module and return exports
/******/ 	// This entry module can't be inlined because the eval devtool is used.
/******/ 	var __webpack_exports__ = __webpack_require__("./src/index.js");
/******/ 	
/******/ })()
;